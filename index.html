const repo = "Microchip-MPLAB-Harmony/usb_apps_device";
const baseUrl = `https://api.github.com/repos/${repo}/git/trees/master?recursive=1`;
const demoList = document.getElementById("demo-list");

async function fetchDemos() {
    try {
        const response = await fetch(baseUrl);
        const data = await response.json();

        // Clear existing content
        demoList.innerHTML = "";

        // Check for valid response
        if (!data.tree) {
            demoList.innerHTML = "Failed to load demos.";
            return;
        }

        // Filter for configurations.xml files
        const filteredItems = data.tree.filter(item => item.path.endsWith("configurations.xml"));

        if (filteredItems.length === 0) {
            demoList.innerHTML = "<li>No configurations.xml files found</li>";
            return;
        }

        // Display the results
        filteredItems.forEach(item => {
            const listItem = document.createElement("li");
            const itemPath = item.path;
            const rawFileUrl = `https://raw.githubusercontent.com/${repo}/master/${itemPath.replace(/\\/g, '/')}`;

            // Create download link
            const link = document.createElement("a");
            link.href = rawFileUrl;
            link.download = "configurations.xml";
            link.textContent = itemPath;

            listItem.appendChild(link);
            demoList.appendChild(listItem);
        });
    } catch (error) {
        console.error("Error fetching data:", error);
        demoList.innerHTML = "Failed to load demos.";
    }
}

// Fetch and display demo list on page load
fetchDemos();
