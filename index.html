<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microchip USB Demos (.X Projects)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            background: #fff;
            margin: 10px auto;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            width: 80%;
            text-align: left;
        }
        a {
            text-decoration: none;
            color: #007BFF;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Microchip USB Demos (.X Projects)</h1>
    <ul id="demo-list">Loading...</ul>

    <script>
        const repo = "Microchip-MPLAB-Harmony/usb_apps_device";
        const baseUrl = `https://api.github.com/repos/${repo}/git/trees/master?recursive=1`;
        const demoList = document.getElementById("demo-list");
        
        // ... (fetchDemos function remains the same)
        
        async function downloadPackage(configUrl) {
            try {
                const response = await fetch(configUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "application/xml");
        
                if (xmlDoc.getElementsByTagName("parsererror").length) {
                    alert("Invalid XML file");
                    return;
                }
        
                const filePaths = Array.from(xmlDoc.getElementsByTagName("file"))
                    .map(file => file.getAttribute("path"))
                    .filter(path => path);
        
                if (filePaths.length === 0) {
                    alert("No files found in configurations.xml");
                    return;
                }
        
                // Display file list in a popup
                const fileListPopup = document.createElement("div");
                fileListPopup.style.position = "fixed";
                fileListPopup.style.top = "50%";
                fileListPopup.style.left = "50%";
                fileListPopup.style.transform = "translate(-50%, -50%)";
                fileListPopup.style.backgroundColor = "white";
                fileListPopup.style.border = "1px solid gray";
                fileListPopup.style.padding = "20px";
                fileListPopup.style.zIndex = "1000"; // Ensure it's on top
        
                const fileList = document.createElement("ul");
                filePaths.forEach(filePath => {
                    const listItem = document.createElement("li");
                    listItem.textContent = filePath;
                    fileList.appendChild(listItem);
                });
                fileListPopup.appendChild(fileList);
        
                const confirmButton = document.createElement("button");
                confirmButton.textContent = "Download";
                confirmButton.addEventListener("click", async () => {
                    document.body.removeChild(fileListPopup); // Close popup
        
                    const zip = new JSZip();
                    const promises = filePaths.map(async filePath => { // ... (rest of the zip creation code)
                        const fileUrl = `https://raw.githubusercontent.com/${repo}/master/${filePath.replace(/\\/g, '/')}`;
                        try {
                            const fileResponse = await fetch(fileUrl);
                            if (!fileResponse.ok) {
                                console.error(`Failed to fetch ${filePath}: ${fileResponse.status}`);
                                return;
                            }
                            const blob = await fileResponse.blob();
                            zip.file(filePath.split('/').pop(), blob);
                        } catch (error) {
                            console.error(`Error fetching ${filePath}:`, error);
                        }
                    });
        
                    await Promise.all(promises);
        
                    const zipBlob = await zip.generateAsync({ type: "blob" });
                    const a = document.createElement("a");
                    a.href = URL.createObjectURL(zipBlob);
                    a.download = "package.zip";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(a.href);
        
                });
                fileListPopup.appendChild(confirmButton);
        
                const cancelButton = document.createElement("button");
                cancelButton.textContent = "Cancel";
                cancelButton.addEventListener("click", () => {
                    document.body.removeChild(fileListPopup);
                });
                fileListPopup.appendChild(cancelButton);
        
        
                document.body.appendChild(fileListPopup);
        
            } catch (error) {
                console.error("Download failed:", error);
                alert("Download failed. Check the console for details.");
            }
        }
        
        
        // ... (JSZip loading remains the same)

    </script>
</body>
</html>
